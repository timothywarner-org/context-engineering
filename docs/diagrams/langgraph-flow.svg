<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 700" style="background:#1a1a2e">
  <defs>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.3"/>
    </filter>
    <linearGradient id="inputGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#5da9e9"/>
      <stop offset="100%" style="stop-color:#4a90d9"/>
    </linearGradient>
    <linearGradient id="nodeGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#5ec69d"/>
      <stop offset="100%" style="stop-color:#50b890"/>
    </linearGradient>
    <linearGradient id="intentGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#f7b84e"/>
      <stop offset="100%" style="stop-color:#f39c12"/>
    </linearGradient>
    <linearGradient id="stateGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#a86cc1"/>
      <stop offset="100%" style="stop-color:#9b59b6"/>
    </linearGradient>
    <linearGradient id="outputGrad" x1="0%" y1="0%" x2="0%" y2="100%">
      <stop offset="0%" style="stop-color:#e95e5e"/>
      <stop offset="100%" style="stop-color:#e74c3c"/>
    </linearGradient>
    <marker id="arrowFlow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#50b890"/>
    </marker>
    <marker id="arrowDashed" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#808090"/>
    </marker>
  </defs>

  <!-- Title -->
  <text x="600" y="35" text-anchor="middle" fill="#e0e0e0" font-family="Segoe UI, Arial, sans-serif" font-size="24" font-weight="bold">WARNERCO Schematica - LangGraph RAG Flow</text>

  <!-- Input Section -->
  <rect x="30" y="60" width="150" height="200" rx="10" fill="#252545" stroke="#4a90d9" stroke-width="2" filter="url(#shadow)"/>
  <text x="105" y="85" text-anchor="middle" fill="#a0a0c0" font-family="Segoe UI, Arial, sans-serif" font-size="12" font-weight="bold">QUERY INPUT</text>

  <rect x="50" y="100" width="110" height="45" rx="6" fill="url(#inputGrad)" filter="url(#shadow)"/>
  <text x="105" y="120" text-anchor="middle" fill="#fff" font-family="Segoe UI, Arial, sans-serif" font-size="11" font-weight="bold">Query</text>
  <text x="105" y="135" text-anchor="middle" fill="#d0e8ff" font-family="Segoe UI, Arial, sans-serif" font-size="9">Natural Language</text>

  <rect x="50" y="155" width="110" height="45" rx="6" fill="url(#inputGrad)" filter="url(#shadow)"/>
  <text x="105" y="175" text-anchor="middle" fill="#fff" font-family="Segoe UI, Arial, sans-serif" font-size="11" font-weight="bold">Filters</text>
  <text x="105" y="190" text-anchor="middle" fill="#d0e8ff" font-family="Segoe UI, Arial, sans-serif" font-size="9">category, model</text>

  <rect x="50" y="210" width="110" height="35" rx="6" fill="url(#inputGrad)" filter="url(#shadow)"/>
  <text x="105" y="232" text-anchor="middle" fill="#fff" font-family="Segoe UI, Arial, sans-serif" font-size="11" font-weight="bold">top_k</text>

  <!-- Flow Nodes -->
  <rect x="210" y="60" width="700" height="200" rx="10" fill="#252545" stroke="#50b890" stroke-width="2" filter="url(#shadow)"/>
  <text x="560" y="85" text-anchor="middle" fill="#a0c0a0" font-family="Segoe UI, Arial, sans-serif" font-size="12" font-weight="bold">LANGGRAPH RAG FLOW</text>

  <!-- Node 1: parse_intent -->
  <rect x="230" y="105" width="120" height="80" rx="8" fill="url(#nodeGrad)" filter="url(#shadow)"/>
  <text x="290" y="130" text-anchor="middle" fill="#fff" font-family="Segoe UI, Arial, sans-serif" font-size="11" font-weight="bold">1. parse_intent</text>
  <line x1="250" y1="140" x2="330" y2="140" stroke="#2e8b57" stroke-width="1"/>
  <text x="290" y="158" text-anchor="middle" fill="#d0f0e0" font-family="Segoe UI, Arial, sans-serif" font-size="9">Classify query</text>
  <text x="290" y="173" text-anchor="middle" fill="#d0f0e0" font-family="Segoe UI, Arial, sans-serif" font-size="9">type</text>

  <!-- Node 2: retrieve -->
  <rect x="360" y="105" width="120" height="80" rx="8" fill="url(#nodeGrad)" filter="url(#shadow)"/>
  <text x="420" y="130" text-anchor="middle" fill="#fff" font-family="Segoe UI, Arial, sans-serif" font-size="11" font-weight="bold">2. retrieve</text>
  <line x1="380" y1="140" x2="460" y2="140" stroke="#2e8b57" stroke-width="1"/>
  <text x="420" y="158" text-anchor="middle" fill="#d0f0e0" font-family="Segoe UI, Arial, sans-serif" font-size="9">Fetch from</text>
  <text x="420" y="173" text-anchor="middle" fill="#d0f0e0" font-family="Segoe UI, Arial, sans-serif" font-size="9">memory backend</text>

  <!-- Node 3: compress_context -->
  <rect x="490" y="105" width="120" height="80" rx="8" fill="url(#nodeGrad)" filter="url(#shadow)"/>
  <text x="550" y="130" text-anchor="middle" fill="#fff" font-family="Segoe UI, Arial, sans-serif" font-size="10" font-weight="bold">3. compress_context</text>
  <line x1="510" y1="140" x2="590" y2="140" stroke="#2e8b57" stroke-width="1"/>
  <text x="550" y="158" text-anchor="middle" fill="#d0f0e0" font-family="Segoe UI, Arial, sans-serif" font-size="9">Minimize</text>
  <text x="550" y="173" text-anchor="middle" fill="#d0f0e0" font-family="Segoe UI, Arial, sans-serif" font-size="9">token bloat</text>

  <!-- Node 4: reason -->
  <rect x="620" y="105" width="120" height="80" rx="8" fill="url(#nodeGrad)" filter="url(#shadow)"/>
  <text x="680" y="130" text-anchor="middle" fill="#fff" font-family="Segoe UI, Arial, sans-serif" font-size="11" font-weight="bold">4. reason</text>
  <line x1="640" y1="140" x2="720" y2="140" stroke="#2e8b57" stroke-width="1"/>
  <text x="680" y="158" text-anchor="middle" fill="#d0f0e0" font-family="Segoe UI, Arial, sans-serif" font-size="9">LLM generates</text>
  <text x="680" y="173" text-anchor="middle" fill="#d0f0e0" font-family="Segoe UI, Arial, sans-serif" font-size="9">response</text>

  <!-- Node 5: respond -->
  <rect x="750" y="105" width="120" height="80" rx="8" fill="url(#nodeGrad)" filter="url(#shadow)"/>
  <text x="810" y="130" text-anchor="middle" fill="#fff" font-family="Segoe UI, Arial, sans-serif" font-size="11" font-weight="bold">5. respond</text>
  <line x1="770" y1="140" x2="850" y2="140" stroke="#2e8b57" stroke-width="1"/>
  <text x="810" y="158" text-anchor="middle" fill="#d0f0e0" font-family="Segoe UI, Arial, sans-serif" font-size="9">Format for</text>
  <text x="810" y="173" text-anchor="middle" fill="#d0f0e0" font-family="Segoe UI, Arial, sans-serif" font-size="9">dashboards/MCP</text>

  <!-- Flow arrows between nodes -->
  <path d="M350 145 L360 145" stroke="#50b890" stroke-width="3" fill="none" marker-end="url(#arrowFlow)"/>
  <path d="M480 145 L490 145" stroke="#50b890" stroke-width="3" fill="none" marker-end="url(#arrowFlow)"/>
  <path d="M610 145 L620 145" stroke="#50b890" stroke-width="3" fill="none" marker-end="url(#arrowFlow)"/>
  <path d="M740 145 L750 145" stroke="#50b890" stroke-width="3" fill="none" marker-end="url(#arrowFlow)"/>

  <!-- Input to Node 1 -->
  <path d="M180 145 L230 145" stroke="#4a90d9" stroke-width="2" fill="none" marker-end="url(#arrowFlow)"/>

  <!-- Intent Classification -->
  <rect x="30" y="290" width="220" height="200" rx="10" fill="#252545" stroke="#f39c12" stroke-width="2" filter="url(#shadow)"/>
  <text x="140" y="315" text-anchor="middle" fill="#d0c0a0" font-family="Segoe UI, Arial, sans-serif" font-size="12" font-weight="bold">INTENT CLASSIFICATION</text>

  <rect x="50" y="330" width="180" height="35" rx="5" fill="url(#intentGrad)" filter="url(#shadow)"/>
  <text x="140" y="352" text-anchor="middle" fill="#fff" font-family="Segoe UI, Arial, sans-serif" font-size="11" font-weight="bold">LOOKUP - Direct ID/name fetch</text>

  <rect x="50" y="375" width="180" height="35" rx="5" fill="url(#intentGrad)" filter="url(#shadow)"/>
  <text x="140" y="397" text-anchor="middle" fill="#fff" font-family="Segoe UI, Arial, sans-serif" font-size="11" font-weight="bold">DIAGNOSTIC - Troubleshooting</text>

  <rect x="50" y="420" width="180" height="35" rx="5" fill="url(#intentGrad)" filter="url(#shadow)"/>
  <text x="140" y="442" text-anchor="middle" fill="#fff" font-family="Segoe UI, Arial, sans-serif" font-size="11" font-weight="bold">ANALYTICS - Stats & aggregations</text>

  <rect x="50" y="465" width="180" height="35" rx="5" fill="url(#intentGrad)" filter="url(#shadow)"/>
  <text x="140" y="487" text-anchor="middle" fill="#fff" font-family="Segoe UI, Arial, sans-serif" font-size="11" font-weight="bold">SEARCH - Semantic matching</text>

  <!-- Dashed arrow from Node 1 to Intents -->
  <path d="M290 185 L290 230 L140 230 L140 290" stroke="#808090" stroke-width="2" stroke-dasharray="5,5" fill="none" marker-end="url(#arrowDashed)"/>
  <text x="215" y="225" fill="#808090" font-family="Segoe UI, Arial, sans-serif" font-size="9">classifies</text>

  <!-- GraphState -->
  <rect x="280" y="290" width="280" height="200" rx="10" fill="#252545" stroke="#9b59b6" stroke-width="2" filter="url(#shadow)"/>
  <text x="420" y="315" text-anchor="middle" fill="#c0a0d0" font-family="Segoe UI, Arial, sans-serif" font-size="12" font-weight="bold">GRAPHSTATE (TypedDict)</text>

  <rect x="300" y="330" width="120" height="28" rx="4" fill="url(#stateGrad)" filter="url(#shadow)"/>
  <text x="360" y="349" text-anchor="middle" fill="#fff" font-family="Segoe UI, Arial, sans-serif" font-size="10">query: string</text>

  <rect x="430" y="330" width="120" height="28" rx="4" fill="url(#stateGrad)" filter="url(#shadow)"/>
  <text x="490" y="349" text-anchor="middle" fill="#fff" font-family="Segoe UI, Arial, sans-serif" font-size="10">intent: QueryIntent</text>

  <rect x="300" y="368" width="120" height="28" rx="4" fill="url(#stateGrad)" filter="url(#shadow)"/>
  <text x="360" y="387" text-anchor="middle" fill="#fff" font-family="Segoe UI, Arial, sans-serif" font-size="9">candidates: SearchResult[]</text>

  <rect x="430" y="368" width="120" height="28" rx="4" fill="url(#stateGrad)" filter="url(#shadow)"/>
  <text x="490" y="387" text-anchor="middle" fill="#fff" font-family="Segoe UI, Arial, sans-serif" font-size="9">compressed_context</text>

  <rect x="300" y="406" width="120" height="28" rx="4" fill="url(#stateGrad)" filter="url(#shadow)"/>
  <text x="360" y="425" text-anchor="middle" fill="#fff" font-family="Segoe UI, Arial, sans-serif" font-size="10">response: dict</text>

  <rect x="430" y="406" width="120" height="28" rx="4" fill="url(#stateGrad)" filter="url(#shadow)"/>
  <text x="490" y="425" text-anchor="middle" fill="#fff" font-family="Segoe UI, Arial, sans-serif" font-size="10">timings: dict</text>

  <rect x="300" y="444" width="250" height="28" rx="4" fill="url(#stateGrad)" filter="url(#shadow)"/>
  <text x="425" y="463" text-anchor="middle" fill="#fff" font-family="Segoe UI, Arial, sans-serif" font-size="10">error: Optional[string]</text>

  <!-- Output -->
  <rect x="940" y="60" width="230" height="200" rx="10" fill="#252545" stroke="#e74c3c" stroke-width="2" filter="url(#shadow)"/>
  <text x="1055" y="85" text-anchor="middle" fill="#d0a0a0" font-family="Segoe UI, Arial, sans-serif" font-size="12" font-weight="bold">QUERY RESPONSE</text>

  <rect x="960" y="100" width="190" height="145" rx="8" fill="url(#outputGrad)" filter="url(#shadow)"/>
  <text x="1055" y="125" text-anchor="middle" fill="#fff" font-family="Segoe UI, Arial, sans-serif" font-size="12" font-weight="bold">QueryResponse</text>
  <line x1="980" y1="135" x2="1130" y2="135" stroke="#c0392b" stroke-width="1"/>
  <text x="1055" y="155" text-anchor="middle" fill="#f0d0d0" font-family="Segoe UI, Arial, sans-serif" font-size="10">success: bool</text>
  <text x="1055" y="172" text-anchor="middle" fill="#f0d0d0" font-family="Segoe UI, Arial, sans-serif" font-size="10">intent: str</text>
  <text x="1055" y="189" text-anchor="middle" fill="#f0d0d0" font-family="Segoe UI, Arial, sans-serif" font-size="10">results: List[Dict]</text>
  <text x="1055" y="206" text-anchor="middle" fill="#f0d0d0" font-family="Segoe UI, Arial, sans-serif" font-size="10">reasoning: Optional[str]</text>
  <text x="1055" y="223" text-anchor="middle" fill="#f0d0d0" font-family="Segoe UI, Arial, sans-serif" font-size="10">query_time_ms: float</text>

  <!-- Arrow from Node 5 to Output -->
  <path d="M870 145 L940 145" stroke="#e74c3c" stroke-width="3" fill="none" marker-end="url(#arrowFlow)"/>

  <!-- Dashed arrows from nodes to state -->
  <path d="M290 185 L360 330" stroke="#808090" stroke-width="1" stroke-dasharray="4,4" fill="none"/>
  <path d="M420 185 L390 330" stroke="#808090" stroke-width="1" stroke-dasharray="4,4" fill="none"/>
  <path d="M550 185 L460 330" stroke="#808090" stroke-width="1" stroke-dasharray="4,4" fill="none"/>
  <path d="M680 185 L490 330" stroke="#808090" stroke-width="1" stroke-dasharray="4,4" fill="none"/>

  <!-- LLM callout -->
  <rect x="590" y="290" width="170" height="80" rx="8" fill="#2d2345" stroke="#9b59b6" stroke-width="1" filter="url(#shadow)"/>
  <text x="675" y="315" text-anchor="middle" fill="#c0a0d0" font-family="Segoe UI, Arial, sans-serif" font-size="10" font-weight="bold">LLM CALL (Node 4)</text>
  <text x="675" y="335" text-anchor="middle" fill="#a090b0" font-family="Segoe UI, Arial, sans-serif" font-size="9">Azure OpenAI</text>
  <text x="675" y="350" text-anchor="middle" fill="#a090b0" font-family="Segoe UI, Arial, sans-serif" font-size="9">gpt-4o-mini</text>
  <text x="675" y="365" text-anchor="middle" fill="#a090b0" font-family="Segoe UI, Arial, sans-serif" font-size="9">(or stub if unavailable)</text>

  <path d="M680 185 L680 290" stroke="#9b59b6" stroke-width="2" stroke-dasharray="5,5" fill="none" marker-end="url(#arrowDashed)"/>

  <!-- Legend -->
  <rect x="800" y="520" width="370" height="140" rx="8" fill="#1a1a2e" stroke="#404060" stroke-width="1"/>
  <text x="985" y="545" text-anchor="middle" fill="#a0a0b0" font-family="Segoe UI, Arial, sans-serif" font-size="11" font-weight="bold">DATA FLOW LEGEND</text>

  <rect x="820" y="560" width="15" height="15" fill="#4a90d9"/>
  <text x="845" y="572" fill="#a0a0b0" font-family="Segoe UI, Arial, sans-serif" font-size="10">Input Parameters</text>

  <rect x="980" y="560" width="15" height="15" fill="#50b890"/>
  <text x="1005" y="572" fill="#a0a0b0" font-family="Segoe UI, Arial, sans-serif" font-size="10">Processing Nodes</text>

  <rect x="820" y="585" width="15" height="15" fill="#f39c12"/>
  <text x="845" y="597" fill="#a0a0b0" font-family="Segoe UI, Arial, sans-serif" font-size="10">Intent Types</text>

  <rect x="980" y="585" width="15" height="15" fill="#9b59b6"/>
  <text x="1005" y="597" fill="#a0a0b0" font-family="Segoe UI, Arial, sans-serif" font-size="10">State Data</text>

  <rect x="820" y="610" width="15" height="15" fill="#e74c3c"/>
  <text x="845" y="622" fill="#a0a0b0" font-family="Segoe UI, Arial, sans-serif" font-size="10">Output Response</text>

  <line x1="980" y1="617" x2="1010" y2="617" stroke="#50b890" stroke-width="3"/>
  <text x="1020" y="622" fill="#a0a0b0" font-family="Segoe UI, Arial, sans-serif" font-size="10">Direct flow</text>

  <line x1="820" y1="642" x2="850" y2="642" stroke="#808090" stroke-width="2" stroke-dasharray="4,4"/>
  <text x="860" y="647" fill="#a0a0b0" font-family="Segoe UI, Arial, sans-serif" font-size="10">State updates</text>
</svg>
